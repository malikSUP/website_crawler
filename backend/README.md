# Backend - Website Contact Parser API

FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –≤–µ–±-—Å–∞–π—Ç–æ–≤.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
backend/
‚îú‚îÄ‚îÄ app.py              # –û—Å–Ω–æ–≤–Ω–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ parser.py           # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä —Å–∞–π—Ç–æ–≤
‚îú‚îÄ‚îÄ batch_parser.py     # –ë–∞—Ç—á-–ø–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ Google Search
‚îú‚îÄ‚îÄ form_analyzer.py    # –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö —Ñ–æ—Ä–º —Å AI
‚îú‚îÄ‚îÄ sitemap_parser.py   # –ü–∞—Ä—Å–∏–Ω–≥ sitemap.xml
‚îú‚îÄ‚îÄ google_search.py    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Search API
‚îú‚îÄ‚îÄ database.py         # –ú–æ–¥–µ–ª–∏ –ë–î –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ schemas.py          # Pydantic —Å—Ö–µ–º—ã –¥–ª—è API
‚îú‚îÄ‚îÄ task_service.py     # –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏
‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ logging_handler.py  # –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ main.py            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ requirements.txt    # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile         # Docker –æ–±—Ä–∞–∑
‚îî‚îÄ‚îÄ alembic/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
```

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ email –∞–¥—Ä–µ—Å–æ–≤** –∏–∑ HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ mailto —Å—Å—ã–ª–æ–∫
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö —Ñ–æ—Ä–º** —Å —É–º–Ω–æ–π –æ—Ü–µ–Ω–∫–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- **AI –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º** —á–µ—Ä–µ–∑ OpenAI API
- **–ü–∞—Ä—Å–∏–Ω–≥ sitemap.xml** –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è —Å–∞–π—Ç–∞
- **–ë–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–∞** –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–∞–π—Ç–æ–≤
- **–°–∏—Å—Ç–µ–º–∞ –∑–∞–¥–∞—á** —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** –≤ CSV —Ñ–æ—Ä–º–∞—Ç

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–∞—Ä—Å–∏–Ω–≥–∞
1. –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∞–π—Ç–∞
2. –ü–æ–∏—Å–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö URL (–∫–æ–Ω—Ç–∞–∫—Ç—ã, –æ –Ω–∞—Å, –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
3. –ü–∞—Ä—Å–∏–Ω–≥ sitemap.xml –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö URL
4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ email –∞–¥—Ä–µ—Å–æ–≤
   - –ü–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º
   - AI –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
docker-compose up backend postgres
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
cd backend
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏ venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cp ../env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª
```

3. **–ó–∞–ø—É—Å–∫ PostgreSQL:**
```bash
docker run -d \
  -e POSTGRES_DB=crawler_db \
  -e POSTGRES_USER=crawler_user \
  -e POSTGRES_PASSWORD=your_password \
  -p 5432:5432 \
  --name postgres_crawler \
  postgres:15-alpine
```

4. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π:**
```bash
alembic upgrade head
```

5. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
python main.py
# –∏–ª–∏
uvicorn app:app --host 0.0.0.0 --port 8000 --reload
```

## üìã API Endpoints

### –ü–∞—Ä—Å–∏–Ω–≥

**POST /api/parse/single** - –ü–∞—Ä—Å–∏–Ω–≥ –æ–¥–Ω–æ–≥–æ —Å–∞–π—Ç–∞
```json
{
  "url": "https://example.com",
  "skip_sitemap": false,
  "use_ai_validation": true
}
```

**POST /api/parse/batch** - –ë–∞—Ç—á-–ø–∞—Ä—Å–∏–Ω–≥
```json
{
  "query": "python development companies",
  "num_results": 10,
  "skip_sitemap": false,
  "use_ai_validation": true
}
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏

**GET /api/task/{task_id}/status** - –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
```json
{
  "id": "uuid",
  "task_type": "single_site",
  "status": "completed",
  "created_at": "2024-01-01T10:00:00Z",
  "completed_at": "2024-01-01T10:05:00Z"
}
```

**GET /api/task/{task_id}/sites** - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞
```json
[
  {
    "domain": "example.com",
    "url": "https://example.com",
    "status": "success",
    "emails": ["contact@example.com"],
    "contact_forms": ["/contact"],
    "processing_time": 15
  }
]
```

**GET /api/task/{task_id}/export/csv** - –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV

**DELETE /api/task/{task_id}** - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏

**GET /api/tasks** - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á

## üîç –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (config.py)

```python
# –õ–∏–º–∏—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞
max_sitemaps = 5
max_urls_per_sitemap = 1000
max_urls_to_process = 50

# –¢–∞–π–º–∞—É—Ç—ã
timeout = (3, 10)  # connection, read

# AI –≤–∞–ª–∏–¥–∞—Ü–∏—è
form_score_threshold = 5
ENABLE_AI_VERIFICATION = True
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# API –∫–ª—é—á–∏
OPENAI_API_KEY=sk-...
GOOGLE_API_KEY=AIza...
GOOGLE_CX=your_search_engine_id

# –°–µ—Ä–≤–µ—Ä
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
DEBUG_MODE=true

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://user:pass@host:5432/db

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=INFO
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª–∏

**Task** - –ó–∞–¥–∞—á–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
- id (UUID)
- task_type (single_site, batch_parse)
- status (running, completed, failed)
- parameters (JSON)
- created_at, completed_at
- error_message

**ParsedSite** - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–∞–π—Ç–æ–≤
- task_id (FK to Task)
- domain, url, title, snippet
- status, emails (JSON), contact_forms (JSON)
- parsed_at, error_message, processing_time

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "Description"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# –û—Ç–∫–∞—Ç
alembic downgrade -1
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install pytest pytest-asyncio httpx

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
python -m pytest

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
python -m pytest --cov=.
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å timestamp –∏ —É—Ä–æ–≤–Ω—è–º–∏
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
- –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –ø–æ —Ä–∞–∑–º–µ—Ä—É

### –ú–µ—Ç—Ä–∏–∫–∏
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Å–∞–π—Ç–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö email'–æ–≤ –∏ —Ñ–æ—Ä–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### Health Check
```bash
curl http://localhost:8000/
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Rate limiting –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ API –∫–ª—é—á–µ–π –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- CORS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è frontend

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ü—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- Retry —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- –£–º–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏ –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- Dependency Injection —á–µ—Ä–µ–∑ FastAPI
- –¢–∏–ø–∏–∑–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é Pydantic –∏ typing

### –ö–æ–¥ —Å—Ç–∞–π–ª
- PEP 8 —Å–æ–±–ª—é–¥–µ–Ω–∏–µ
- Type hints –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- Docstrings –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤

### Debugging
```bash
# –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
DEBUG_MODE=true python main.py

# –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
LOG_LEVEL=DEBUG python main.py
``` 